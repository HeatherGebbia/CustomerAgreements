@page "{dependentQuestionId:int}"
@model CustomerAgreements.Pages.DependentQuestions.EditModel

@{
    ViewData["Title"] = "Edit Dependent Question";
}

<h1>Edit Dependent Question</h1>

<form method="post">
    <partial name="_DependentQuestionForm" model="Model.DependentQuestion" />
</form>

<!-- List items grid (separate from Save form) -->
@if (Model.DependentQuestion.DependentAnswerType != null && Model.DependentQuestion.DependentAnswerType.ToLower().Contains("list"))
{
    <div id="listItemsRow" class="form-group d-flex align-items-start mt-4">
        <div style="flex:0 0 15%; max-width:15%;" class="text-right pr-2">
            <label class="p-2 d-block">List Items</label>
            <a asp-page="/DependentQuestionLists/Create"
               asp-route-dependentQuestionId="@Model.DependentQuestion.DependentQuestionID"
               asp-route-questionId="@Model.DependentQuestion.QuestionID"
               asp-route-questionnaireId="@Model.DependentQuestion.QuestionnaireID"
               asp-route-sectionId="@Model.DependentQuestion.SectionID"
               class="btn btn-link btn-sm p-0">
                + Add Item
            </a>
        </div>

        <div style="flex:1 0 auto; width:auto;">
            <div id="listMessage" class="text-info mb-2"></div>

            @if (Model.DependentQuestion.DependentQuestionLists != null && Model.DependentQuestion.DependentQuestionLists.Any())
            {
                <table class="table table-bordered table-sm w-auto">
                    <thead>
                        <tr>
                            <th>List Item</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.DependentQuestion.DependentQuestionLists.OrderBy(i => i.SortOrder))
                        {
                            <tr>
                                <td>@item.ListValue</td>
                                <td>
                                    <a asp-page="/DependentQuestionLists/Edit"
                                       asp-route-dependentQuestionListId="@item.DependentQuestionListID"
                                       class="btn btn-sm btn-primary">Edit</a>

                                    <!-- Delete is its own form -->
                                    <form method="post"
                                          asp-page-handler="DeleteListItem"
                                          asp-route-dependentQuestionListId="@item.DependentQuestionListID"
                                          asp-route-dependentQuestionId="@Model.DependentQuestion.DependentQuestionID"
                                          class="d-inline-block">
                                        <button type="submit" class="btn btn-sm btn-danger"
                                                onclick="return confirm('Delete this item?');">
                                            Delete
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <em>No items yet. Please add list items.</em>
            }
        </div>
    </div>
}

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="~/js/dependentQuestionForm.js"></script>
}
